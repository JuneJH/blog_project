# 事件循环

> Javascript代码通过JavaScript引擎运行,该引擎为一个单线程
> Javascript引擎通过执行栈保证运行代码得运行顺序
> 异步事件通过宏队列和微队列进行排队进入执行栈

## 浏览器端

1. 当Javascript代码运行在浏览器端时存在五个线程

- 1. JS引擎
- 2. GUI线程
- 3. 事件监听线程
- 4. 计时线程
- 5. 网络线程
*JS引擎与GUI线程是相斥的*

2. 代码执行流程

- 1. script代码进入开始执行
- 2. 绑定事件交给`事件监听线程`当事件发生时把该事件函数交给`宏队列`交给计时线程,等待运行时机把事件函数交给宏队列
- 4. 发生网络请求时交给网
- 3. 发生计时器、延时器络线程处理
- 5. 同步代码执行完成后执行栈清空,优先运行微队列的事件,等清空微队列后页面可能发生渲染再执行宏队列
*此过程再整个程序运行期间保持这个运转体系*

1. 微队列

> 在浏览器端除了promise和MutationObserver会进入微队列,其余的异步事件都进入宏队列

- promise
- MutatationObserver

4. 宏队列 
   
- script
- setTimeout
- setInterval
- HTTP请求
- 事件触发

执行队列(宏队列) => 微队列 => 页面重新渲染(有可能) => 宏队列 => 微队列 => 页面可能重新渲染

**理解: 一个宏队列的执行就是一个事件循环**
**当微队列清空时就会触发一次重新渲染进入下一次宏队列**
**结论: 并非微队列的优先级大于宏队列**

## Nodejs端