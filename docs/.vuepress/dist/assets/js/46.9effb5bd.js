(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{432:function(t,s,a){"use strict";a.r(s);var n=a(54),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"http-缓存机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-缓存机制"}},[t._v("#")]),t._v(" HTTP 缓存机制")]),t._v(" "),a("blockquote",[a("p",[t._v("对于web系统来说:图片、第三方库等资源发生改变的可能性是比较低的,所以我们可以把这些文件放在客户端存储下来\n但是web系统迭代的速度相对而言也是比较快的,客户端并不知道我们系统的资源会发生变化,而沿用之前的资源\n以上情况可以利用HTTP缓存机制对web系统进行优化,达到更好的用户体验")])]),t._v(" "),a("h2",{attrs:{id:"_1-http-缓存机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-http-缓存机制"}},[t._v("#")]),t._v(" 1. HTTP 缓存机制？")]),t._v(" "),a("ul",[a("li",[t._v("当用户访问系统时如果不做缓存,那么该用户无论是跳转该域下的页面或者再次访问该系统时,都会请求所有所需的静态资源")]),t._v(" "),a("li",[t._v("如果用户每次访问都需要请求相同的静态资源到本地进行渲染,这对系统的性能和用户的体验都是很不友好的")]),t._v(" "),a("li",[t._v("根据HTTP缓存机制,可以把静态资源缓存在本地,用户再次访问时之间使用缓存资源而不需要再次从服务端获取")]),t._v(" "),a("li",[t._v("利用这种方式既可以提高系统的性能也能提升用户体验,节省带宽")])]),t._v(" "),a("h2",{attrs:{id:"_2-http缓存机制存储位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-http缓存机制存储位置"}},[t._v("#")]),t._v(" 2. HTTP缓存机制存储位置")]),t._v(" "),a("ul",[a("li",[t._v("Service worker: HTTPS协议支持,自定义缓存规则")]),t._v(" "),a("li",[t._v("Memory Cache: 内存缓存")]),t._v(" "),a("li",[t._v("Disk Cache: 磁盘缓存")]),t._v(" "),a("li",[t._v("Push Cache: HTTP2支持 TODO")])]),t._v(" "),a("h2",{attrs:{id:"_3-http缓存机制模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-http缓存机制模式"}},[t._v("#")]),t._v(" 3. HTTP缓存机制模式")]),t._v(" "),a("blockquote",[a("p",[t._v("强缓存\n协商缓存")])]),t._v(" "),a("ul",[a("li",[t._v("使用强缓存策略时,浏览器不会向服务端发送请求,该资源直接从"),a("code",[t._v("disk cache")]),t._v("或者"),a("code",[t._v("memory cache")]),t._v("中获取,http状态码为"),a("code",[t._v("200")])]),t._v(" "),a("li",[t._v("使用协商缓存时,如果强缓存并未命中成功,那么使用协商缓存,协商缓存携带"),a("code",[t._v("if-modified-since")]),t._v("或者"),a("code",[t._v("if-none-mathc")]),t._v("请求头,如果协商缓存失效则正常请求(http返回正常的请求),如果缓存未失效返回"),a("code",[t._v("304 not modified")])])]),t._v(" "),a("h2",{attrs:{id:"_4-http缓存机制-强缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-http缓存机制-强缓存"}},[t._v("#")]),t._v(" 4. HTTP缓存机制-强缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("强缓存通过"),a("code",[t._v("expires")]),t._v("和"),a("code",[t._v("cache-control")]),t._v("控制")])]),t._v(" "),a("h3",{attrs:{id:"_1-expires"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-expires"}},[t._v("#")]),t._v(" 1. expires")]),t._v(" "),a("ul",[a("li",[t._v("用于指定缓存过期时间,在这个时间段内不会再向服务端发送请求")]),t._v(" "),a("li",[t._v("该字段的值为一个具体的时间,它会依赖客户端的时间,因此该属性的使用就有一定的局限性")]),t._v(" "),a("li",[a("em",[t._v("目前测试下post请求缓存没有生效,大概原因为浏览器不缓存post请求")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在express中设置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/getCache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"收到请求"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"expires"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("count\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浏览器应该是不缓存post请求,我认为post是带操作的不应该进行强缓存")]),t._v("\n    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/postCache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"收到请求"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"expires"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("count\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"_2-cache-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cache-control"}},[t._v("#")]),t._v(" 2. cache-control")]),t._v(" "),a("blockquote",[a("p",[t._v("http1.1中用来控制缓存的字段,如果在http1.1的环境下"),a("code",[t._v("cache-control")]),t._v("的优先级要高于"),a("code",[t._v("expires")]),t._v("\n鉴于"),a("code",[t._v("expires")]),t._v("的局限性,目前"),a("code",[t._v("expires")]),t._v("适合在非http1.1环境下使用(向下兼容)")])]),t._v(" "),a("ul",[a("li",[t._v("public: 谁都可以缓存,客户端、中间件")]),t._v(" "),a("li",[t._v("private: 只有客户端能缓存")]),t._v(" "),a("li",[t._v("no-cache: 客户端使用协商缓存")]),t._v(" "),a("li",[t._v("no-store: 不缓存")]),t._v(" "),a("li",[t._v("max-age: 缓存在多少秒后失效")])]),t._v(" "),a("h2",{attrs:{id:"_5-http缓存机制-协商缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-http缓存机制-协商缓存"}},[t._v("#")]),t._v(" 5. HTTP缓存机制-协商缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("通过"),a("code",[t._v("last-modified")]),t._v("和"),a("code",[t._v("etag")]),t._v("控制\n当再次请求时请求头会通过"),a("code",[t._v("if-modified-sice")]),t._v("和"),a("code",[t._v("if-none-match")]),t._v("携带以上两个字段的值\n服务器收到这两个字段做出判断资源是否发生改变,如果没有发生改变就返回"),a("code",[t._v("304 not modified")]),t._v("浏览器使用缓存资源,如果发生改变就走正常的请求流程\n"),a("code",[t._v("etag")]),t._v("的优先级高于"),a("code",[t._v("last-modified")])])]),t._v(" "),a("h2",{attrs:{id:"_6-http缓存机制-express实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-http缓存机制-express实践"}},[t._v("#")]),t._v(" 6. HTTP缓存机制-express实践")]),t._v(" "),a("ul",[a("li",[t._v("使用中间件"),a("code",[t._v("express.static()")]),t._v("配置第二个参数")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        lastModified"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        etag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        maxAge"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("接口返回直接设置响应头")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"expires"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n \n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);