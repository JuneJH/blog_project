<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cross-Origin-Resource-Sharing 跨域资源共享 | JuneJH</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.75473690.js" as="script"><link rel="preload" href="/assets/js/2.8c11f49f.js" as="script"><link rel="preload" href="/assets/js/47.f0d2b854.js" as="script"><link rel="prefetch" href="/assets/js/10.b610653e.js"><link rel="prefetch" href="/assets/js/100.acece0c3.js"><link rel="prefetch" href="/assets/js/101.44645056.js"><link rel="prefetch" href="/assets/js/102.54d7cbc3.js"><link rel="prefetch" href="/assets/js/103.6f06f068.js"><link rel="prefetch" href="/assets/js/104.7c59b56b.js"><link rel="prefetch" href="/assets/js/105.51190178.js"><link rel="prefetch" href="/assets/js/106.bd33d190.js"><link rel="prefetch" href="/assets/js/11.4cb3b0d6.js"><link rel="prefetch" href="/assets/js/12.529c3674.js"><link rel="prefetch" href="/assets/js/13.0982f329.js"><link rel="prefetch" href="/assets/js/14.7c2b2b32.js"><link rel="prefetch" href="/assets/js/15.2b4bb874.js"><link rel="prefetch" href="/assets/js/16.98b60686.js"><link rel="prefetch" href="/assets/js/17.95b8444a.js"><link rel="prefetch" href="/assets/js/18.07af37ef.js"><link rel="prefetch" href="/assets/js/19.7b44b462.js"><link rel="prefetch" href="/assets/js/20.ee427676.js"><link rel="prefetch" href="/assets/js/21.a14af8ea.js"><link rel="prefetch" href="/assets/js/22.3a9b3af4.js"><link rel="prefetch" href="/assets/js/23.3a0666fc.js"><link rel="prefetch" href="/assets/js/24.f46b71ee.js"><link rel="prefetch" href="/assets/js/25.c7fefb91.js"><link rel="prefetch" href="/assets/js/26.7fb6ce6c.js"><link rel="prefetch" href="/assets/js/27.52c72a07.js"><link rel="prefetch" href="/assets/js/28.ed2832e4.js"><link rel="prefetch" href="/assets/js/29.c7c3cab2.js"><link rel="prefetch" href="/assets/js/3.4e83e6d5.js"><link rel="prefetch" href="/assets/js/30.b58c173c.js"><link rel="prefetch" href="/assets/js/31.18aaf55d.js"><link rel="prefetch" href="/assets/js/32.e9222cf3.js"><link rel="prefetch" href="/assets/js/33.0e78dad4.js"><link rel="prefetch" href="/assets/js/34.37cc3f94.js"><link rel="prefetch" href="/assets/js/35.d81a1c3f.js"><link rel="prefetch" href="/assets/js/36.0bfb58b5.js"><link rel="prefetch" href="/assets/js/37.47e6e68a.js"><link rel="prefetch" href="/assets/js/38.546525ad.js"><link rel="prefetch" href="/assets/js/39.50e48d08.js"><link rel="prefetch" href="/assets/js/4.fbcf4621.js"><link rel="prefetch" href="/assets/js/40.dfd04ada.js"><link rel="prefetch" href="/assets/js/41.46d81a34.js"><link rel="prefetch" href="/assets/js/42.33bdc7f6.js"><link rel="prefetch" href="/assets/js/43.2fef28c5.js"><link rel="prefetch" href="/assets/js/44.2f4a281a.js"><link rel="prefetch" href="/assets/js/45.15d41b73.js"><link rel="prefetch" href="/assets/js/46.9effb5bd.js"><link rel="prefetch" href="/assets/js/48.cd8d9787.js"><link rel="prefetch" href="/assets/js/49.d228fe29.js"><link rel="prefetch" href="/assets/js/5.ec4b3f90.js"><link rel="prefetch" href="/assets/js/50.a22eebad.js"><link rel="prefetch" href="/assets/js/51.46408fe9.js"><link rel="prefetch" href="/assets/js/52.a0743a7e.js"><link rel="prefetch" href="/assets/js/53.3e998c97.js"><link rel="prefetch" href="/assets/js/54.35e95df8.js"><link rel="prefetch" href="/assets/js/55.133842e1.js"><link rel="prefetch" href="/assets/js/56.6353ecc5.js"><link rel="prefetch" href="/assets/js/57.164fc5aa.js"><link rel="prefetch" href="/assets/js/58.07e04701.js"><link rel="prefetch" href="/assets/js/59.62c11d67.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/60.b07fa48a.js"><link rel="prefetch" href="/assets/js/61.89a60286.js"><link rel="prefetch" href="/assets/js/62.5e4788b3.js"><link rel="prefetch" href="/assets/js/63.ea50b78c.js"><link rel="prefetch" href="/assets/js/64.1cca3bdb.js"><link rel="prefetch" href="/assets/js/65.4147e986.js"><link rel="prefetch" href="/assets/js/66.3650f7a3.js"><link rel="prefetch" href="/assets/js/67.4ed02925.js"><link rel="prefetch" href="/assets/js/68.2c522348.js"><link rel="prefetch" href="/assets/js/69.21442473.js"><link rel="prefetch" href="/assets/js/7.18c81a0e.js"><link rel="prefetch" href="/assets/js/70.01c26412.js"><link rel="prefetch" href="/assets/js/71.abc190e4.js"><link rel="prefetch" href="/assets/js/72.c63e6daa.js"><link rel="prefetch" href="/assets/js/73.63aee2ed.js"><link rel="prefetch" href="/assets/js/74.a5bf3564.js"><link rel="prefetch" href="/assets/js/75.80543035.js"><link rel="prefetch" href="/assets/js/76.431071ff.js"><link rel="prefetch" href="/assets/js/77.ce3cabc9.js"><link rel="prefetch" href="/assets/js/78.7c959c4d.js"><link rel="prefetch" href="/assets/js/79.06c26c0a.js"><link rel="prefetch" href="/assets/js/8.fa1b2a2c.js"><link rel="prefetch" href="/assets/js/80.abf0bff0.js"><link rel="prefetch" href="/assets/js/81.7f07bb27.js"><link rel="prefetch" href="/assets/js/82.a0b063ec.js"><link rel="prefetch" href="/assets/js/83.168f0843.js"><link rel="prefetch" href="/assets/js/84.4c091942.js"><link rel="prefetch" href="/assets/js/85.4bd9e377.js"><link rel="prefetch" href="/assets/js/86.7dc85582.js"><link rel="prefetch" href="/assets/js/87.86400caf.js"><link rel="prefetch" href="/assets/js/88.0de12709.js"><link rel="prefetch" href="/assets/js/89.0f2a88c2.js"><link rel="prefetch" href="/assets/js/9.98404b8c.js"><link rel="prefetch" href="/assets/js/90.e63ee580.js"><link rel="prefetch" href="/assets/js/91.c87d9531.js"><link rel="prefetch" href="/assets/js/92.51f5dab6.js"><link rel="prefetch" href="/assets/js/93.b424b143.js"><link rel="prefetch" href="/assets/js/94.87455eb8.js"><link rel="prefetch" href="/assets/js/95.2251c10e.js"><link rel="prefetch" href="/assets/js/96.8f341aa4.js"><link rel="prefetch" href="/assets/js/97.612d7357.js"><link rel="prefetch" href="/assets/js/98.0b1b8468.js"><link rel="prefetch" href="/assets/js/99.dfa80316.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">JuneJH</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/1.html" class="nav-link">
  vue相关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/1.html" class="nav-link">
  vue相关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span></span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>O M</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data Visualization</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Full Stack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Http</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/http/HTTP缓存机制.html" class="sidebar-link">HTTP 缓存机制</a></li><li><a href="/http/cors.html" aria-current="page" class="active sidebar-link">Cross-Origin-Resource-Sharing 跨域资源共享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/http/cors.html#简单请求" class="sidebar-link">简单请求</a></li><li class="sidebar-sub-header"><a href="/http/cors.html#需要发送预检的请求" class="sidebar-link">需要发送预检的请求</a></li><li class="sidebar-sub-header"><a href="/http/cors.html#附带身份验证信息" class="sidebar-link">附带身份验证信息</a></li><li class="sidebar-sub-header"><a href="/http/cors.html#修成正果-客户端收到服务端的跨域资源" class="sidebar-link">修成正果:客户端收到服务端的跨域资源</a></li><li class="sidebar-sub-header"><a href="/http/cors.html#最后" class="sidebar-link">最后</a></li></ul></li><li><a href="/http/前端网络安全.html" class="sidebar-link">前端网络安全</a></li><li><a href="/http/网络.html" class="sidebar-link">网络协议</a></li><li><a href="/http/跨域.html" class="sidebar-link">浏览器的同源策略</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Package Manager</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cross-origin-resource-sharing-跨域资源共享"><a href="#cross-origin-resource-sharing-跨域资源共享" class="header-anchor">#</a> Cross-Origin-Resource-Sharing 跨域资源共享</h1> <blockquote><p><code>CORS</code>是在<code>HTTP1.1</code>提出的一种跨域解决方案
跨域是浏览器对我们的安全保护，如果服务器同意使用该资源，那么这种保护就没有必要了
简单请求-对服务器资源不会造成太大的影响
与之相反的则需要发送预捡请求再发送真实请求</p></blockquote> <h2 id="简单请求"><a href="#简单请求" class="header-anchor">#</a> 简单请求</h2> <blockquote><p>请求方法为<code>get</code>,<code>post</code>,<code>head</code>
请求头只包含安全字段<code>Accept</code>,<code>Accept-Language</code>,<code>Content-Language</code>,<code>Content-Type</code>,<code>DPR</code>,<code>Downlink</code>,<code>Save-Data</code>,<code>Viewport-Width</code>,<code>Width</code>
其中<code>Content-Type</code>只能为<code>text/plain</code>,<code>mutipart/form-data</code>,<code>application/x-www-form-urlencoded</code>中一个值
<strong>同时满足以上三条，则为简单请求</strong></p></blockquote> <h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <blockquote><p>Nodejs
express框架
fetch</p></blockquote> <ol><li>客户端发送一个请求学生列表</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:9527/student&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                method<span class="token operator">:</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span>data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ol start="2"><li>服务器端设置<code>Access-Control-Allow-Origin</code>来应对简单请求的跨域</li></ol> <blockquote><p><code>Access-Control-Allow-Origin</code> 的值可以为<code>*</code>或者具体的源(可通过请求头获取，浏览器为用户发送简单请求自动添加<code>Origin</code>属性)
<code>*</code>表示所有允许所有源访问，<strong>如果请求需要携带身份凭证，则不允许设置该值</strong>
具体的源表示只针对该域进行跨域访问(服务器可维护可跨域访问资源白名单)</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>请求头</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>    Accept<span class="token operator">:</span> */\*
    Accept-Encoding<span class="token operator">:</span> gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br
    Accept-Language<span class="token operator">:</span> zh-CN<span class="token punctuation">,</span>zh;q=<span class="token number">0.9</span><span class="token punctuation">,</span>en;q=<span class="token number">0.8</span>
    Cache-Control<span class="token operator">:</span> no-cache
    Connection<span class="token operator">:</span> keep-alive
    Host<span class="token operator">:</span> <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">9527</span>
    Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342   // 浏览器为其添加该属性，指定具体的源</span>
    Pragma<span class="token operator">:</span> no-cache
    Referer<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342/</span>
    Sec-Fetch-Dest<span class="token operator">:</span> empty
    Sec-Fetch-Mode<span class="token operator">:</span> cors
    Sec-Fetch-Site<span class="token operator">:</span> cross-site
    User-Agent<span class="token operator">:</span> Mozilla/<span class="token number">5.0</span> (Windows NT <span class="token number">10.0</span>; Win64; x64) AppleWebKit/<span class="token number">537.36</span> (KHTML<span class="token punctuation">,</span> like Gecko) Chrome/<span class="token number">87.0</span>.<span class="token number">4280.66</span> Safari/<span class="token number">537.36</span>
</code></pre></div><ol start="4"><li>响应头</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>    Access-Control-Allow-Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342   // 服务器为其设置可访问源</span>
    Connection<span class="token operator">:</span> keep-alive
    Content-Length<span class="token operator">:</span> <span class="token number">17215</span>
    Content-Type<span class="token operator">:</span> application/json; charset=utf<span class="token number">-8</span>
    Date<span class="token operator">:</span> Thu<span class="token punctuation">,</span> <span class="token number">26</span> Nov <span class="token number">2020</span> <span class="token number">02</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">36</span> GMT
    ETag<span class="token operator">:</span> W/<span class="token string">&quot;433f-QlFxK67TOrn0mHqplU4/RdfiIoY&quot;</span>
    X-Powered-By<span class="token operator">:</span> Express
</code></pre></div><h2 id="需要发送预检的请求"><a href="#需要发送预检的请求" class="header-anchor">#</a> 需要发送预检的请求</h2> <blockquote><p>在不满足简单请求的三大条，那么浏览器将为他先发送一条预检请求
得到服务器允许后再发送真实请求</p></blockquote> <h3 id="预检请求"><a href="#预检请求" class="header-anchor">#</a> 预检请求</h3> <blockquote><p>预检请求是浏览器再确定真是请求非简单请求自行发送给服务端的请求
该请求的方法为<code>OPTIONS</code>
只有请求头，没有消息体，也没有我们所设置的请求头
其中包含了一下请求头</p> <ol><li>origin:具体的源</li> <li>Access-Control-Request-Method:真实请求使用的请求方法</li> <li>Access-Control-Request-Headers:真实请求的添加或者改变的请求头</li></ol></blockquote> <h4 id="_1-真实请求"><a href="#_1-真实请求" class="header-anchor">#</a> 1. 真实请求</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:9527/student&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            method<span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
            headers<span class="token operator">:</span> <span class="token punctuation">{</span>
                myHeader<span class="token operator">:</span> <span class="token string">&quot;this is my header&quot;</span>   <span class="token comment">// 因为添加了请求头，因此不满足简单请求</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-客户端准备预捡请求"><a href="#_2-客户端准备预捡请求" class="header-anchor">#</a> 2. 客户端准备预捡请求</h4> <p>当浏览器发现不是简单请求后，自行组装一个预捡请求</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// √是需要关注的地方</span>
  √ OPTIONS /student HTTP/<span class="token number">1.1</span>    <span class="token comment">// 该请求为OPTIOINS</span>
    Host<span class="token operator">:</span> <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">9527</span>
    Connection<span class="token operator">:</span> keep-alive
    Pragma<span class="token operator">:</span> no-cache
    Cache-Control<span class="token operator">:</span> no-cache
    Accept<span class="token operator">:</span> */\*
  √ Access-Control-Request-Method<span class="token operator">:</span> GET       <span class="token comment">// 真实请求的请求方法</span>
  √ Access-Control-Request-Headers<span class="token operator">:</span> myheader <span class="token comment">// 真实请求所添加和改变的请求头   </span>
  √ Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342          // 浏览器组装具体的源</span>
    User-Agent<span class="token operator">:</span> Mozilla/<span class="token number">5.0</span> (Windows NT <span class="token number">10.0</span>; Win64; x64) AppleWebKit/<span class="token number">537.36</span> (KHTML<span class="token punctuation">,</span> like Gecko) Chrome/<span class="token number">87.0</span>.<span class="token number">4280.66</span> Safari/<span class="token number">537.36</span>
    Sec-Fetch-Mode<span class="token operator">:</span> cors
    Sec-Fetch-Site<span class="token operator">:</span> cross-site
    Sec-Fetch-Dest<span class="token operator">:</span> empty
    Referer<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342/</span>
    Accept-Encoding<span class="token operator">:</span> gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br
    Accept-Language<span class="token operator">:</span> zh-CN<span class="token punctuation">,</span>zh;q=<span class="token number">0.9</span><span class="token punctuation">,</span>en;q=<span class="token number">0.8</span>
</code></pre></div><h4 id="_3-服务端需要对预检请求响应-否则将不再进行跨域资源共享"><a href="#_3-服务端需要对预检请求响应-否则将不再进行跨域资源共享" class="header-anchor">#</a> 3. 服务端需要对预检请求响应，否则将不再进行跨域资源共享</h4> <blockquote><p>但服务器收到预捡请求后，必须给予响应，并且需要包含以下请求头</p> <ol><li>Access-Control-Allow-Origin:允许的具体的源</li> <li>Access-Control-Allow-Methods:对应预捡请求的<code>Access-Control-Request-Method</code>,表示我服务端所允许的请求方法</li> <li>Access-Control-Allow-Headers:对应预检请求的<code>Access-Control-Request-Headers</code>,表示我服务端允许改动的请求头</li> <li>? Access-Control-Allow-Max-Age: 可选的 设置再此时间段，对于与本次相同的请求(预检请求所必带请求头的值相同)，浏览器都不需要再发送预检请求</li></ol></blockquote> <ol><li>服务端设置</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-control-allow-method&quot;</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;access-control-request-method&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-allow-headers&quot;</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;access-control-request-headers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要将浏览器的缓存打开Disable cache</span>
    <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>服务端响应给预检请求</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>    Access-Control-allow-headers<span class="token operator">:</span> myheader
    Access-control-allow-method<span class="token operator">:</span> GET
    Access-Control-Allow-Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342</span>
    Access-Control-Max-Age<span class="token operator">:</span> <span class="token number">1000</span>
    Allow<span class="token operator">:</span> GET<span class="token punctuation">,</span>POST<span class="token punctuation">,</span>HEAD
    Connection<span class="token operator">:</span> keep-alive
    Content-Length<span class="token operator">:</span> <span class="token number">13</span>
    Content-Type<span class="token operator">:</span> text/html; charset=utf<span class="token number">-8</span>
    Date<span class="token operator">:</span> Thu<span class="token punctuation">,</span> <span class="token number">26</span> Nov <span class="token number">2020</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">36</span><span class="token operator">:</span><span class="token number">58</span> GMT
    ETag<span class="token operator">:</span> W/<span class="token string">&quot;d-5V0bEbsSC17Ya0KqDVcZsTZ+vh8&quot;</span>
    X-Powered-By<span class="token operator">:</span> Express
</code></pre></div><h3 id="真实请求就与常规相同"><a href="#真实请求就与常规相同" class="header-anchor">#</a> 真实请求就与常规相同</h3> <h2 id="附带身份验证信息"><a href="#附带身份验证信息" class="header-anchor">#</a> 附带身份验证信息</h2> <blockquote><p>一个请求如果需要带cookie这样的身份信息，必须征得服务器的同意，否则一切请求浏览器都会视为跨域处理
服务器端设置响应头<code>Access-Control-Allow-Credentials:true</code>即可，表明服务端需要携带身份认证信息
<strong>注意：该响应头无论是简单请求还是预检请求都需要得到服务器的认证</strong></p></blockquote> <ol><li>客户端修改请求</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:9527/student&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                method<span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
                headers<span class="token operator">:</span> <span class="token punctuation">{</span>
                    myHeader<span class="token operator">:</span> <span class="token string">&quot;this is my header&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                credentials<span class="token operator">:</span><span class="token string">&quot;include&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 如果是ajax，为其withCredentials属性设置为true</span>
</code></pre></div><ol start="2"><li>服务端设置</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="修成正果-客户端收到服务端的跨域资源"><a href="#修成正果-客户端收到服务端的跨域资源" class="header-anchor">#</a> 修成正果:客户端收到服务端的跨域资源</h2> <blockquote><p>此时服务端不设置任何响应头属性，JavaScript只能拿到部分安全的响应头
如果需要拿到自定义的一些响应头，需要服务端设置<code>Access-Control-Expose-Headers</code>
该属性的值则表示服务端允许JavaScript操作的一些响应头</p></blockquote> <h3 id="获取自定义响应头"><a href="#获取自定义响应头" class="header-anchor">#</a> 获取自定义响应头</h3> <ol><li>服务端</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;my-header&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;this is come from service!!!&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>客户端</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:9527/student&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            method<span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
            headers<span class="token operator">:</span> <span class="token punctuation">{</span>
                myHeader<span class="token operator">:</span> <span class="token string">&quot;this is my header&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            credentials<span class="token operator">:</span><span class="token string">&quot;include&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;my-header&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// this is come from service!!!</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>不修改客户端代码，但是开起一个跨域的服务，跨域访问资源</li></ol> <p>控制输入:```null``</p> <ol start="4"><li>服务端允许操作<code>my-header</code>响应头</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;my-header&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;this is come from service!!!&quot;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;my-header1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;this is come from service!!!&quot;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Expose-Headers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;my-header,my-header1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>一切正常</strong></p> <ul><li>响应头</li></ul> <div class="language-json extra-class"><pre class="language-json"><code>    Access-Control-Allow-Credentials<span class="token operator">:</span> <span class="token boolean">true</span>
    Access-Control-Allow-Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:63342</span>
    Access-Control-Expose-Headers<span class="token operator">:</span> my-header<span class="token punctuation">,</span>my-header1
    Connection<span class="token operator">:</span> keep-alive
    Content-Length<span class="token operator">:</span> <span class="token number">17215</span>
    Content-Type<span class="token operator">:</span> application/json; charset=utf<span class="token number">-8</span>
    Date<span class="token operator">:</span> Thu<span class="token punctuation">,</span> <span class="token number">26</span> Nov <span class="token number">2020</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">56</span><span class="token operator">:</span><span class="token number">06</span> GMT
    ETag<span class="token operator">:</span> W/<span class="token string">&quot;433f-QlFxK67TOrn0mHqplU4/RdfiIoY&quot;</span>
    my-header<span class="token operator">:</span> this is come from service!!!
    my-header1<span class="token operator">:</span> this is come from service!!!
    X-Powered-By<span class="token operator">:</span> Express
</code></pre></div><h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <blockquote><p>虽然此处是使用Node环境，但是CORS流程是相同的
本文主要基于自定义中间件，但是实际开发可以使用```cors``中间件<a href="https://github.com/expressjs/cors" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http/HTTP缓存机制.html" class="prev">
        HTTP 缓存机制
      </a></span> <span class="next"><a href="/http/前端网络安全.html">
        前端网络安全
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.75473690.js" defer></script><script src="/assets/js/2.8c11f49f.js" defer></script><script src="/assets/js/47.f0d2b854.js" defer></script>
  </body>
</html>
