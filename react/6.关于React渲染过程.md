# React 渲染过程

> 使用React开发浏览器端应用需要引入`react`和`react-dom`库,其中`react-dom`库主要是将react元素生成相应的真实DOM元素
> 通常使用`JSX`语法来书写react元素,它是`react-dom`的一种语法糖
> 渲染就是把react元素生成真实的DOM并加入到document中

## 1. JSX对象

- `JSX`是Facebook起草的Javascript扩展语法(目前处于草案阶段)
- `React.createElement`用于生成一个不可变的React元素
- `JSX`是`React.createElement`的一个语法糖

1. 示例

```js

    const app = (<div style={{ color: "red" }} className="app">
        <p>我是p元素</p>
        <h1>我是和h1元素</h1>
    </div>)

```

2. 简易app对象

```js

    {
      $$typeof:"-",
      key:null,     // 后期用于优化
      props:{       
        children:[{...},{...}],    // 后代子元素
        className:"",   // 类型
        style:{},       // 样式
        ...
      },
      type:"",        // **元素类型**
    }

```

## 2. react元素类型

- 通过`React.createElement`得到一个React元素对象
- 通过该对象的`type`属性决定怎么处理
  
1. 字符串类型(`div`)              => ReactDOMComponent
2. 组件类型(`class/function`)     => ReactCompositeComponentWrapper
3. 非对象类型(数字,字符串)         => ReactDOMTextComponent
4. null、undefined、false等       => ReactDOMEmptyComponent
5. 数组类型                       => 遍历出来使用以上方案 

## 3. 开始首次渲染

-  通过react元素的类型对react元素对象进行处理
-  得到真实DOM节点形成虚拟DOM树
-  该虚拟DOM树会被保存下来
-  将该虚拟DOM加入容器

1. 从根节点开始执行代码
2. 根据不同的元素类型执行不同处理流程
   - 非对象类型(数字,字符串)通过`ReactDOMTextComponent`进行处理,其中利用`mountComponent`方法生成真实DOM(`document.createTextNode`)
   - null、undefined等通过`ReactDOMEmptyComponent`处理
   - 字符串类型(`div`) 使用`ReactDOMComponent`进行处理,生成真实DOM(document.createElement),递归该`children`属性
   - 组件类型 使用`ReactCompositeComponentWrapper`进行处理
   - 1. 函数组件:调用函数得到一个react元素对象,进行以上操作
   - 2. 类组件: 得到该类实例,调用`static getDerivedStateFromProps`生命周期方法 调用render()得到一个react元素对象,进行以上操作,将`componentDidMount`加入队列,挂载完成后执行
3. 将该树加入容器

## 4. 更新阶段

