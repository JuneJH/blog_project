# Redux 数据管理

> 后端的MVC模式
> 现代的React、vue等框架不适用MVC

## 1. 书写action

```js

    export const SETLOGINUSER = Symbol("set-login-user");
    export const SETTIMEOUT = Symbol("setTimeout");

    export const createLoginAction = (payload) => ({
        type: SETLOGINUSER,
        payload
    })
    // 使用thunk中间件支持action为一个函数
    export const effect = () => (
        function (dispatch, a, b) {
            dispatch(createLoginAction("马上设置"));
            setTimeout(() => {
                dispatch(createLoginAction("延后设置"))
            }, 3000);
        }
    )

```

## 2. 创建store

> 仓库:通过`createStore(reducer,?action)`创建,接受reducer和初始值

- dispatch: 分发执行reduce,参数为action
- getState: 得到仓库的值
- replaceReducer: 替换当前仓库的Reducer
- subscribe: 仓库值发生改变时触发,监听事件

## 3. 书写reduce


```js

    import * as loginAction from '../action/loginAction'
    const initialState = {
        loginUser: null,
    }

    export default (state = initialState, { type, payload }) => {
        console.log(type)
        switch (type) {

            case loginAction.SETLOGINUSER:
                return { ...state, ...payload }

            default:
                return state
        }
    }

```

## 3.简单使用

```js

    import {createStore} from 'redux';
    const action = {
        type:"IN"
    }
    function reducer(state,action){
        if(action.type === "In"){
            return state + 1;
        }else if(action.typ === "Out"){
            return state - 1;
        }
        return state;
    }

    const store = createStore(reducer,1); // 传入reducer和状态默认值,一个store只有一个state

    console.log(store.getState());
    store.dispatch(action);
    console.log(store.getState());

```

## 中间件

> 通过对`store.dispatch`重新赋值
> 在重新赋值的过程中保存之前的`store.dispatch`在中间件中合适的位置执行
> 利用函数组合合并多个中间件

### 1. redux-thunk

- 使用该中间件可以让action为函数,原理是当dispatch时,在该中间件执行时会把时函数的action执行后再处理,普通的acton将不做任何处理
- 使用该中间件必须为第一个

### 2. redux-logger

- 日志打印中间件

### 3. redux-action

### 4. redux-promise